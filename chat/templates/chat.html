{% extends 'principal/base.html' %} 
{% load static %}

{% block css_files %}
    <link rel="stylesheet" href="{% static 'css/global-ia.css' %}" />
    <link rel="stylesheet" href="{% static 'css/chat.css' %}" />
    <link rel="stylesheet" href="{% static 'css/responsivity.css' %}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=a Absolute Empire:wght@400&display=swap"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,400&display=swap"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,700;1,700&display=swap"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400&display=swap"/>
{% endblock %}

{% block conteudo %}
<div>
    <a href="{% url 'index' %}">home</a>
    <a href="{% url 'buscarmesa' %}">Voltar ao Mural</a> <br> <br>
  </div>
  
  <br>
  
  <div id="chat-log" style="border:1px solid;width:500px;height:400px;">
  
  
    {% for mensagem in mensagens %}
    <p><a href="{% url 'exibir_perfil' perfil_slug=mensagem.autor.username|lower %}">{{ mensagem.autor }}: ({{ mensagem.tempo}})</p> </a>
    <p>  {{ mensagem.conteudo }}</p>
    {% if mensagem.autor == user %}
        <a href="{% url 'excluir_mensagem_pub' mensagem.id %}">Excluir</a>
    {% endif %}
    {% endfor %}
 
  <title> chat </title>
  
  </div>
  
  <br>
  <input id="chat-message-input" type="text" size="60" placeholder="Escrever mensagem">
  <br>
  <br>
  
  <input id="chat-message-submit" type="button" value="Enviar">
  
  <script>
  
  base_url =  'ws://' + window.location.hostname + ':' + window.location.port + '/ws/open_chat/' + "{{ uuid }}" + '/';
  
  chatSocket = new WebSocket(base_url);
  
  chatSocket.onmessage = function(event){
      let parsed = JSON.parse(event.data);
      document.querySelector('#chat-log').innerHTML += '<p>' + parsed.message + '</p>';
  }
  
  document.querySelector('#chat-message-submit').onclick = function(e) {
      const messageInputDom = document.querySelector('#chat-message-input');
          const message = messageInputDom.value;
          chatSocket.send(JSON.stringify({
          'message': message
          }));
      messageInputDom.value = '';
      };
  
  </script>

{% endblock conteudo %}